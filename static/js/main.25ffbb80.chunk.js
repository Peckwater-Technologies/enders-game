(this.webpackJsonpenders=this.webpackJsonpenders||[]).push([[0],{13:function(e){e.exports=JSON.parse('{"minWidth":2200,"grid":{"freqWidth":20,"transparency":0.3},"background":{"colour":"#608038","x":0,"y":0},"shooter":{"radius":20,"colour":"blue","enemy":"#ff0000","handColour":"white","gunColour":"black","handRadius":5,"gunWidth":8,"gunLength":30},"bullet":{"colour":"#080808"},"tree":{"colour":"#2d572c","trunkColour":"#381f08","min":20,"max":50}}')},18:function(e){e.exports=JSON.parse('{"surface":{"width":1920,"height":1080},"players":[{"x":[200,3800],"y":[100,1900],"angle":[0,360]},{"x":[200,3800],"y":[100,1900],"angle":[0,360]}],"bullets":[{"x":150,"y":150,"angle":45},{"x":160,"y":160,"angle":45},{"x":170,"y":170,"angle":45}],"trees":15,"scale":1,"minX":0,"minY":0}')},37:function(e,t,r){e.exports=r(94)},42:function(e,t,r){},93:function(e,t,r){},94:function(e,t,r){"use strict";r.r(t);var a,n=r(0),i=r.n(n),o=r(35),l=r.n(o),s=(r(42),r(8)),u=r(9),c=r(12),h=r(10),d=r(11),y=r(24),p=r(16),f=r(5),g={gameWidth:1920,gameHeight:1080,fps:30,playerRadius:20,playerMoveSpeed:50,playerTurnSpeed:180,sensorRadius:300,noSensors:20,bulletSpeed:500,bulletRadius:2,bulletDamage:.5,bulletCooldown:1,treeRadius:30};!function(e){e[e.Circle=0]="Circle",e[e.Square=1]="Square"}(a||(a={}));var b=r(13),m=b.shooter,v=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.data;return i.a.createElement(f.Group,{rotation:e.angle+90,x:e.x,y:e.y},i.a.createElement(f.Circle,{ref:"player",radius:g.playerRadius,fill:this.props.i?m.enemy:m.colour,rotation:e.angle}),i.a.createElement(f.Rect,{id:"gun",x:-.5*m.gunWidth,y:-Math.sqrt(2)*g.playerRadius-m.gunLength,width:m.gunWidth,height:m.gunLength,fill:m.gunColour}),i.a.createElement(f.Circle,{id:"left-hand",y:-g.playerRadius,radius:5,fill:"white",rotation:e.angle}),i.a.createElement(f.Ellipse,{id:"right-hand",width:2*m.handRadius,height:2*m.handRadius,x:m.gunWidth,y:-2*g.playerRadius,fill:m.handColour}))}}]),t}(i.a.Component),w=b.bullet,j=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.data;return i.a.createElement(f.Group,{rotation:e.angle,x:e.x,y:e.y},i.a.createElement(f.Circle,{radius:g.bulletRadius,fill:w.colour}))}}]),t}(i.a.Component);function O(e,t){var r=Math.random();return Math.floor(r*(t-e+1)+e)}var k=b.tree,S=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){for(var e,t,r=this,a=this.props,n=[],o=0;o<4;o++){var l=1&o,s=2&o;n.push(i.a.createElement(f.Circle,{key:["tree",a.x,a.y,o].join("."),x:(l?1:-1)*g.treeRadius+O(-20,20,this.props.rand),y:(s?1:-1)*g.treeRadius+O(-20,20,this.props.rand),radius:O(2*g.treeRadius,3*g.treeRadius,this.props.rand),fill:(e=(t=k.colour,t.startsWith("#")&&(t=t.slice(1)),6!==t.length?[0,0,0]:[t.slice(0,2),t.slice(2,4),t.slice(4,6)].map((function(e){return parseInt(e,16)}))).map((function(e){return e+O(-30,30,r.props.rand)})),"#"+e.map((function(e){var t=e.toString(16);return"0".repeat(2-t.length)+t})).join("")),opacity:.6}))}return i.a.createElement(f.Group,{rotation:O(0,360,this.props.rand),x:a.x,y:a.y},n,i.a.createElement(f.Circle,{radius:g.treeRadius+5,fill:"black",opacity:.6}),i.a.createElement(f.Circle,{key:["tree",a.x,a.y,"trunk"].join("."),id:["tree",a.x,a.y,"trunk"].join("."),radius:g.treeRadius,fill:k.trunkColour,opacity:.8}))}}]),t}(i.a.Component),x=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){for(var e=this.props,t=e.height,r=e.width,a=e.freq,n=Math.ceil(r/a),o=[],l=[],s=0;s<a;s++)o.push(i.a.createElement(f.Rect,{key:["grid","horizontal",s].join("."),x:n*s,width:2,height:t,fill:"black",opacity:b.grid.transparency}));for(var u=0;u<Math.ceil(t/n);u++)l.push(i.a.createElement(f.Rect,{key:["grid","vertical",u].join("."),y:n*u,height:1,width:r,fill:"black",opacity:b.grid.transparency}));return i.a.createElement(f.Group,null,l,o)}}]),t}(i.a.Component),R=r(18),E=b.background,M=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(c.a)(this,Object(h.a)(t).call(this,e))).checkSize=r.checkSize.bind(Object(p.a)(r)),r.updateState=r.updateState.bind(Object(p.a)(r)),R.surface.width=window.innerWidth,R.surface.height=window.innerHeight,r.state=function e(t){if(Array.isArray(t)){if(t.every((function(e){return"number"===typeof e})))return O(t[0],t[1]);var r=[],a=!0,n=!1,i=void 0;try{for(var o,l=t[Symbol.iterator]();!(a=(o=l.next()).done);a=!0){var s=o.value;"object"!==typeof s?r.push(s):r.push(e(s))}}catch(b){n=!0,i=b}finally{try{a||null==l.return||l.return()}finally{if(n)throw i}}return r}for(var u={},c=0,h=Object.entries(t);c<h.length;c++){var d=h[c],p=Object(y.a)(d,2),f=p[0],g=p[1];u[f]="object"!==typeof g?g:e(g)}return u}(R),r.state.rand=Math.random(),r}return Object(d.a)(t,e),Object(u.a)(t,[{key:"redeploy",value:function(e){e&&this._trees&&delete this._trees}},{key:"updateState",value:function(e){var t=Object.assign(this.state,e),r=this.getScale(t),a=Object(y.a)(r,3),n=a[0],i=a[1],o=a[2];t=Object.assign(t,{scale:n,minX:i,minY:o}),this.setState(t)}},{key:"componentDidMount",value:function(){this.checkSize(),window.addEventListener("resize",this.checkSize)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.checkSize)}},{key:"checkSize",value:function(){var e=this.state;e.surface.width=window.innerWidth,e.surface.height=window.innerHeight,this.setState(e)}},{key:"getTrees",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(this._trees&&this._trees.length)return this._trees;for(var t=[],r=0;r<e.length;r++)t.push(i.a.createElement(S,Object.assign({key:["tree",r].join(".")},e[r])));return this._trees=t}},{key:"getScale",value:function(e){var t=e.players[0].x,r=e.players[0].y,a=e.players[1].x,n=e.players[1].y,i=50+g.playerRadius,o=Math.min(t,a)-i,l=Math.min(r,n)-i,s=Math.abs(a-t)+2*i,u=Math.abs(n-r)+2*i,c=window.innerWidth/s,h=window.innerHeight/u,d=Math.min(Math.min(c,h),2);return isNaN(d)&&(d=1),[d,o-10,l-10]}},{key:"render",value:function(){return i.a.createElement(f.Stage,Object.assign({},this.state.surface,{x:-this.state.minX*this.state.scale,y:-this.state.minY*this.state.scale,scale:{x:this.state.scale,y:this.state.scale}}),i.a.createElement(f.Layer,{id:"background"},i.a.createElement(f.Rect,{width:g.gameWidth,height:g.gameHeight,fill:E.colour})),i.a.createElement(f.Layer,{id:"grid"},i.a.createElement(x,{width:g.gameWidth,height:g.gameHeight,freq:b.grid.freqWidth})),i.a.createElement(f.Layer,{id:"bullets"},this.state.bullets.map((function(e,t){return i.a.createElement(j,{key:["bullet",t].join("."),data:e})}))),i.a.createElement(f.Layer,Object.assign({id:"players"},this.state.layer),this.state.players.map((function(e,t){return i.a.createElement(v,{key:["shooter",t].join("."),i:t,data:e})}))),i.a.createElement(f.Layer,{id:"trees"},this.getTrees(this.state.obstacles)))}}]),t}(i.a.Component);r(93);var C=function(){function e(){Object(s.a)(this,e)}return Object(u.a)(e,[{key:"act",value:function(e){var t=1===e.enemySensors[0];return{fireBullet:t,turnLeft:!t,turnRight:!1,moveForward:t}}}]),e}(),W=37,L=39,z=38,H=40,P=32;var D=r(19),A=r(36);function B(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function q(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?B(r,!0).forEach((function(t){Object(A.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var F=1/g.fps,I={createState:function(e){var t=[{x:O(g.playerRadius,g.gameWidth-g.playerRadius),y:O(g.playerRadius,g.gameHeight-g.playerRadius),angle:45,cooldown:0,health:1},{x:O(g.playerRadius,g.gameWidth-g.playerRadius),y:O(g.playerRadius,g.gameHeight-g.playerRadius),angle:225,cooldown:0,health:1}];return{players:t,bullets:[],obstacles:X(t,Math.floor(g.gameWidth*g.gameHeight/4e4))}},updateState:function(e,t){for(var r=e.players.length,a=[],n=[],i=0;i<r;i++){var o=e.players[i],l=t[i],s=o.cooldown,u=o.angle;l.fireBullet&&o.cooldown<.01?(a.push({sourceAgent:i,x:o.x,y:o.y,angle:o.angle}),s=g.bulletCooldown):s=Math.max(0,s-F),l.turnLeft&&(u-=g.playerTurnSpeed*F%360),l.turnRight&&(u+=g.playerTurnSpeed*F%360);var c=q({},o,{cooldown:s,angle:u});l.moveForward&&(c=G(c,g.playerMoveSpeed*F,g.playerRadius,e.obstacles)),n.push(c)}var h=Array(r).fill(0),d=!0,y=!1,p=void 0;try{for(var f,b=e.bullets[Symbol.iterator]();!(d=(f=b.next()).done);d=!0){for(var m=f.value,v=!1,w=0;w<r;w++){if(_(e.players[w],m,w)){v=!0,h[w]+=g.bulletDamage;break}}if(!v){var j=G(m,g.bulletSpeed*F,0,e.obstacles);j.x>0&&j.x<g.gameWidth&&j.y>0&&j.y<g.gameHeight&&a.push(j)}}}catch(S){y=!0,p=S}finally{try{d||null==b.return||b.return()}finally{if(y)throw p}}for(var O=!1,k=0;k<r;k++)n[k].health-=h[k],n[k].health<.01&&(O=!0);return{newState:q({},e,{players:n,bullets:a}),isDone:O,reward:h.map((function(e){return-e}))}},generateObservation:function(e,t){for(var r=e.players[t],a=r.x,n=r.y,i=r.angle,o=r.cooldown,l=360/g.noSensors,s=[],u=[],c=0;c<g.noSensors;c++){for(var h=(i+c*l)/180*Math.PI,d=[Math.cos(h+Math.PI/2),Math.sin(h+Math.PI/2)],y=[Math.cos(h),Math.sin(h)],p=T(a,n,g.playerRadius,d,y),f=T(a,n,g.bulletRadius,d,y),b=0,m=0,v=e.players.length,w=0;w<v;w++)if(w!==t&&N(p,[e.players[w].x,e.players[w].y])){b=1;break}var j=!0,O=!1,k=void 0;try{for(var S,x=e.bullets[Symbol.iterator]();!(j=(S=x.next()).done);j=!0){var R=S.value;if(R.sourceAgent!=t&&N(f,[R.x,R.y])){m=1;break}}}catch(E){O=!0,k=E}finally{try{j||null==x.return||x.return()}finally{if(O)throw k}}s.push(b),u.push(m)}return{x:a,y:n,angle:i,cooldown:o,health:r.health,enemySensors:s,bulletSensors:u,obstacleSensors:[]}},observationSize:5+3*g.noSensors,getData:function(e){return[e.x,e.y,e.angle,e.cooldown,e.health].concat(Object(D.a)(e.obstacleSensors),Object(D.a)(e.enemySensors),Object(D.a)(e.bulletSensors))},actionSize:4,getAction:function(e){return{fireBullet:e[0]>.5,turnLeft:e[1]>.5,turnRight:e[2]>.5,moveForward:e[3]>.5}}};function _(e,t,r){return Math.hypot(e.x-t.x,e.y-t.y,2)<g.playerRadius+g.bulletRadius&&t.sourceAgent!=r}function G(e,t,r,n){var i=e.angle/180*Math.PI,o=e.x+Math.cos(i)*t,l=e.y+Math.sin(i)*t;o>g.gameWidth-r?o=g.gameWidth-r:o<r&&(o=r),l>g.gameHeight-r?l=g.gameHeight-r:l<r&&(l=r);var s=!0,u=!1,c=void 0;try{for(var h,d=n[Symbol.iterator]();!(s=(h=d.next()).done);s=!0){var y=h.value,p=.05*(o-y.x),f=.05*(l-y.y);switch(y.shape){case a.Circle:case a.Square:for(;r+y.size>Math.hypot(o-y.x,l-y.y)+.1;)if(o+=p,l+=f,r<1){o=1e6;break}}}}catch(b){u=!0,c=b}finally{try{s||null==d.return||d.return()}finally{if(u)throw c}}return q({},e,{x:o,y:l})}function N(e,t){var r=[t[0]-e[0][0],t[1]-e[0][1]],a=[e[1][0]-e[0][0],e[1][1]-e[0][1]],n=[e[3][0]-e[0][0],e[3][1]-e[0][1]],i=J(r,a),o=J(a,a),l=J(r,n),s=J(n,n);return 0<i&&i<o&&0<l&&l<s}function T(e,t,r,a,n){var i=[a[0]*r,a[1]*r],o=[n[0]*(r+g.sensorRadius),n[1]*(r+g.sensorRadius)],l=[e+i[0],t+i[1]],s=[e-i[0],t-i[1]];return[l,s,[s[0]+o[0],s[1]+o[1]],[l[0]+o[0],l[1]+o[1]]]}function J(e,t){for(var r=0,a=e.length,n=t.length,i=0;i<a&&i<n;i++)r+=e[i]*t[i];return r}function X(e,t){for(var r=[],n=0;n<t;n++){var i=O(0,g.gameWidth),o=O(0,g.gameHeight),l=g.treeRadius,s=!1,u=!0,c=!1,h=void 0;try{for(var d,y=e[Symbol.iterator]();!(u=(d=y.next()).done);u=!0){var p=d.value;if(Math.hypot(i-p.x,o-p.y)<g.playerRadius+l-.1){s=!0;break}}}catch(f){c=!0,h=f}finally{try{u||null==y.return||y.return()}finally{if(c)throw h}}s||r.push({x:i,y:o,shape:a.Circle,size:l})}return r}var Y=function(e){function t(){var e,r;Object(s.a)(this,t);for(var a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(r=Object(c.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(n)))).player=function(){var e={turnLeft:!1,turnRight:!1,moveForward:!1,fireBullet:!1};return[function(t){switch(t.keyCode){case W:e.turnLeft=!1;break;case L:e.turnRight=!1;break;case z:e.moveForward=!1;break;case P:e.fireBullet=!1}},function(t){switch(t.keyCode){case W:e.turnLeft=!0;break;case L:e.turnRight=!0;break;case z:e.moveForward=!0;break;case H:e.moveForward=!1;break;case P:e.fireBullet=!0}},{act:function(t){return e}}]}(),r}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.player[1]),document.addEventListener("keyup",this.player[0])}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.player[1]),document.removeEventListener("keyup",this.player[0])}},{key:"render",value:function(){var e=i.a.createRef(),t=this.player[2],r=new C;return function(e,t,r,a){var n=e.createState(0);setInterval((function(){var a=t.map((function(t,r){var a=e.generateObservation(n,r);return t.act(a)})),i=e.updateState(n,a),o=i.newState,l=i.isDone;n=o,l&&(console.log("Game finished. Restarting..."),n=e.createState(0),r.redeploy(n)),r.render(n)}),1e3/a)}(I,[t,r],{redeploy:function(t){return e.current&&e.current.redeploy(t)},render:function(t){return e.current&&e.current.updateState(t)}},g.fps),i.a.createElement("div",{className:"App",id:"container",ref:"container",style:{backgroundColor:"#835C3B"}},i.a.createElement(M,{ref:e}))}}]),t}(i.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(i.a.createElement(Y,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[37,1,2]]]);
//# sourceMappingURL=main.25ffbb80.chunk.js.map